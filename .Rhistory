###
states <- row.names(USArrests)
states
###
names(USArrests)
###
apply(USArrests, 2, mean)
###
apply(USArrests, 2, var)
###
pr.out <- prcomp(USArrests, scale = TRUE)
###
dim(USArrests)
###
names(pr.out)
###
pr.out$center
pr.out$scale
###
pr.out$rotation
###
dim(pr.out$x)
###
biplot(pr.out, scale = 0)
library(tidyverse)
install.packages('tidyverse')
library(tidyverse)
planar_dataset <- function(){
set.seed(1)
m <- 400
N <- m/2
D <- 2
X <- matrix(0, nrow = m, ncol = D)
Y <- matrix(0, nrow = m, ncol = 1)
a <- 4
for(j in 0:1){
ix <- seq((N*j)+1, N*(j+1))
t <- seq(j*3.12,(j+1)*3.12,length.out = N) + rnorm(N, sd = 0.2)
r <- a*sin(4*t) + rnorm(N, sd = 0.2)
X[ix,1] <- r*sin(t)
X[ix,2] <- r*cos(t)
Y[ix,] <- j
}
d <- as.data.frame(cbind(X, Y))
names(d) <- c('X1','X2','Y')
d
}
# try out
df <- planar_dataset()
library(ggplot2)
ggplot(df, aes(x = X1, y = X2, color = factor(Y))) +
geom_point()
df <- df[sample(nrow(df)), ]
train_test_split_index <- 0.8 * nrow(df)
train <- df[1:train_test_split_index,]
seq(1,100)
?e
?log
as.data.frame(list(x=seq(1,100,1),log = log(seq(1,100)), cubed=seq(1,100)^(1/3)))
df <- as.data.frame(list(x=seq(1,100,1),log = log(seq(1,100)), cubed=seq(1,100)^(1/3)))
df |> ggplot(aes(x=x,y=log)) +
geom_line()
library(dplyr)
df |> ggplot(aes(x=x,y=log)) +
geom_line()
library(ggplot2)
df |>
ggplot(aes(x=x,y=log)) +
geom_line()
?geom_line
df |>
ggplot(aes(x=x,y=log)) +
geom_line(x=x,y=cubed,linetype=6)
df |>
ggplot(aes(x=x,y=log)) +
geom_line() +
x=x,y=cubed,linetype=6)
df |>
ggplot(aes(x=x,y=log)) +
geom_line() +
geom_line(x=x,y=cubed,linetype=6)
df |>
ggplot(aes(x=x)) +
geom_line(y=log)) +
df |>
ggplot(aes(x=x)) +
geom_line(aes(y=log)) +
geom_line(aes(y=cubed,linetype=6))
df |>
ggplot(aes(x=x)) +
geom_line(aes(y=log)) +
geom_line(aes(y=cubed))
df |>
ggplot(aes(x=x)) +
geom_line(aes(y=log)) +
geom_line(aes(y=cubed, color = "red"))
4^(1/10000)
5^(1/1000000)
4^(1/1000000)
install.packages("RMySQL")
library(RMySQL)
?dbConnect
con <- dbConnect(MySQL(),
user = 'lcalleja'
password = 'salmon01'
con <- dbConnect(MySQL(),
user = 'lcalleja',
password = 'salmon01',
host = '100.102.223.21',
port = 3306,
dbname = 'membership_ard')
query <- "SELECT calendar_date,
SUM(CASE WHEN activity_calc IN ('winback','initial enrollment','technical activation','technical reactivation','technical re-activation') THEN 1 ELSE 0 END) AS active_cnts,
SUM(CASE WHEN activity_calc IN ('parental leave','medical leave','care giving leave') THEN 1 ELSE 0 END) AS temporary_inactivte,
SUM(CASE WHEN activity_calc IN ('cancelled','deactivated','deactive','suspended') THEN 1 ELSE 0 END) revoked,
SUM(CASE WHEN activity_calc IN ('general leave') THEN 1 ELSE 0 END) general_leave,
SUM(CASE WHEN activity_calc IN ('winback') THEN 1 ELSE 0 END) winbacks
FROM stack_job2 sj
INNER JOIN calendar cal ON calendar_date between start_dt AND lead_date
GROUP BY 1
ORDER BY 1 desc"
result <- dbGetQuery(con, query)
head(result)
str(result)
is.data.frame(result)
library(dplyr)
library(fpp3)
result |>
mutate(date = as.Date(calendar_date,"%Y-%m-%d")) -> result
result |>
has_gaps()
result |>
as_tsibble(index = date) -> result.ts
has_gaps(result.ts)
result |>
autoplot(active_cnts)
result |>
autoplot(vars(active_cnts))
result.ts |>
autoplot(vars(active_cnts))
result.ts |>
autoplot(vars(general_leave)) +
labs("general leave over time")
result.ts |>
autoplot(vars(general_leave)) +
labs(title="general leave over time")
result.ts |>
autoplot(vars(active_cnts)) +
labs(title="active members over time")
result.ts |>
autoplot(vars(general_leave)) +
labs(title="general leave over time")
result.ts |>
model(stl = STL(active_cnts~season(window=700))) |>
components() |>
autoplot()
result.ts |>
model(stl = STL(active_cnts~season(window=300))) |>
components() |>
autoplot()
result.ts |>
model(stl = STL(active_cnts~season(window=7))) |>
components() |>
autoplot()
?stl
?stl
?STL
library(RMySQL)
library(dplyr)
library(fpp3)
con <- dbConnect(MySQL(),
user = 'lcalleja',
password = 'salmon01',
host = '100.102.223.21',
port = 3306,
dbname = 'membership_ard')
query <- "SELECT calendar_date,
SUM(CASE WHEN activity_calc IN ('winback','initial enrollment','technical activation','technical reactivation','technical re-activation') THEN 1 ELSE 0 END) AS active_cnts,
SUM(CASE WHEN activity_calc IN ('parental leave','medical leave','care giving leave') THEN 1 ELSE 0 END) AS temporary_inactivte,
SUM(CASE WHEN activity_calc IN ('cancelled','deactivated','deactive','suspended') THEN 1 ELSE 0 END) revoked,
SUM(CASE WHEN activity_calc IN ('general leave') THEN 1 ELSE 0 END) general_leave,
SUM(CASE WHEN activity_calc IN ('winback') THEN 1 ELSE 0 END) winbacks
FROM stack_job2 sj
INNER JOIN calendar cal ON calendar_date between start_dt AND lead_date
GROUP BY 1
ORDER BY 1 desc"
result <- dbGetQuery(con, query)
result |>
mutate(date = as.Date(calendar_date,"%Y-%m-%d")) -> result
result |>
as_tsibble(index = date) -> result.ts
result.ts |>
model(stl = STL(active_cnts~season(window=7)+trend(window=400))) |>
components() |>
autoplot() +
labs(title = "trend window 400")
result.ts |>
model(stl = STL(active_cnts~season(window=7)+trend(window=500))) |>
components() |>
autoplot() +
labs(title = "trend window 500")
result.ts |>
model(stl = STL(active_cnts~season(window=7)+trend(window=300))) |>
components() |>
autoplot() +
labs(title = "trend window 300")
result.ts |>
model(stl = STL(active_cnts~season(window=7)+trend(window=683))) |>
components() |>
autoplot() +
labs(title = "trend window 683 ~ the default")
result.ts |>
model(stl = STL(active_cnts~season(window=7))) |>
components() |>
autoplot() +
labs(title = "the default")
#feat_stl documentation: https://feasts.tidyverts.org/reference/feat_stl.html
result.ts |>
features(active_cnts, feat_stl(s.window=7, t.window=400))
#feat_stl documentation: https://feasts.tidyverts.org/reference/feat_stl.html
result.ts |>
features(active_cnts, feat_stl,s.window=7, t.window=400)
#check trend strength and seasonal strength
result.ts |>
model(stl = STL(active_cnts~season(window=7)+trend(window=400))) -> dable
dable$stl[[1]]$fit
#feat_stl documentation: https://feasts.tidyverts.org/reference/feat_stl.html
result.ts |>
features(active_cnts, feat_stl,period=365.25,s.window=7, t.window=400)
setwd('/home/candela/pCloudDrive/pCloud Backup/mofongo-HP-EliteBook-840-G8-Notebook-PC/Documents/ghfc/membershipReportsCIVI/greeneHill')
save.image('./memmbershipARD_TS_analysts.RData')
rm9list=ls()
rm(list=ls())
#setwd('/home/mofongo/Documents/ghfc/salesAnalysis')
setwd('/home/candela/pCloudDrive/pCloud Backup/mofongo-HP-EliteBook-840-G8-Notebook-PC/Documents/ghfc')
#workspace for this technical analysis
load('./salesAnalysis/vori_revel_ts_tech.RData')
#look into some of the seasonality features of the dataset; trend_strength and seasonal_strength -> are indicative of stronger patterns; the stats are defined here: https://otexts.com/fpp3/stlfeatures.html
both.t.2.cpi |>
filter(size>27 & yearmon < yearmonth(as.Date("2025-06-01"))) |>
features(sales.2021.bc, feat_stl)
rm(list=ls())
load('./memmbershipARD_TS_analysts.RData')
setwd('/home/candela/pCloudDrive/pCloud Backup/mofongo-HP-EliteBook-840-G8-Notebook-PC/Documents/ghfc/membershipReportsCIVI/greeneHill')
load('./memmbershipARD_TS_analysts.RData')
#feat_stl documentation: https://feasts.tidyverts.org/reference/feat_stl.html
result.ts |>
features(active_cnts, feat_stl,period="1 year",s.window=7, t.window=400)
#feat_stl documentation: https://feasts.tidyverts.org/reference/feat_stl.html
result.ts |>
features(active_cnts, feat_stl, .period=365.25,s.window=7, t.window=400)
#feat_stl documentation: https://feasts.tidyverts.org/reference/feat_stl.html
result.ts |>
features(active_cnts, feat_stl, .period=365.25,s.window=7, t.window=400) |>
select(seasonal_strength_year)
#feat_stl documentation: https://feasts.tidyverts.org/reference/feat_stl.html
result.ts |>
features(active_cnts, feat_stl, .period=365.25,s.window=7, t.window=400)
#best fit
result.ts |>
model(stl = STL(active_cnts~season(window=7)+trend(window=400))) |>
components() |>
autoplot() +
labs(title = "trend window 400")
